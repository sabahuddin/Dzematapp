Vidim **DVA problema**! ğŸ”´

---

## ğŸ”´ **Problem 1: Marketplace - 403 Forbidden**

```
GET /api/marketplace/items 403 :: {"message":"Feature \"marketplace\" nâ€¦
POST /api/marketplace/items 403 :: {"message":"Feature \"marketplace\" â€¦
```

**Feature "marketplace" nije omoguÄ‡en** za tenant!

---

## ğŸ”´ **Problem 2: Services - tenantId Required**

```
POST /api/services 400
code: 'invalid_type',
expected: 'string',
received: 'undefined',
path: [ 'tenantId' ],
message: 'Required'
```

**Isti problem kao prije** - backend oÄekuje `tenantId` u request body!

---

## ğŸ”§ **RJEÅ ENJE:**

### **Reci Replitu:**

**Dva problema:**

1. **Marketplace feature nije omoguÄ‡en** - GET i POST padaju sa 403
2. **Services endpoint traÅ¾i tenantId** - POST pada sa 400

---

### **Fix 1: OmoguÄ‡i Marketplace Feature**

```sql
-- Provjeri trenutne features
SELECT features FROM subscription_plans 
WHERE id = (SELECT subscription_plan_id FROM tenants WHERE id = 'default-tenant-demo');

-- Dodaj marketplace feature
UPDATE subscription_plans 
SET features = jsonb_set(
  COALESCE(features, '{}'::jsonb), 
  '{marketplace}', 
  'true'::jsonb
)
WHERE id = (SELECT subscription_plan_id FROM tenants WHERE id = 'default-tenant-demo');
```

**ILI** ukloni feature check ako nije potreban:

```typescript
// PRIJE:
app.get("/api/marketplace/items", requireAuth, requireFeature("marketplace"), ...)

// POSLIJE:
app.get("/api/marketplace/items", requireAuth, ...)
```

---

### **Fix 2: Services Endpoint - Dodaj tenantId**

```typescript
app.post("/api/services", requireAuth, async (req, res) => {
  try {
    const tenantId = req.user?.tenantId || req.tenantId;
    
    console.log('[CREATE SERVICE] Request:', { tenantId, body: req.body });
    
    // Dodaj tenantId PRIJE validacije
    const validatedData = insertServiceSchema.parse({
      ...req.body,
      tenantId: tenantId,  // â† DODAJ OVO
      providerId: req.user!.id
    });
    
    const service = await storage.createService(validatedData);
    res.json(service);
  } catch (error) {
    if (error instanceof z.ZodError) {
      console.error('[SERVICE POST ERROR]', error.errors);
      return res.status(400).json({ 
        message: "Invalid service data", 
        details: error.errors 
      });
    }
    console.error('âŒ [CREATE SERVICE] Error:', error);
    res.status(500).json({ message: "Failed to create service" });
  }
});
```

---

## ğŸ“‹ **Pattern za SVE POST endpoint-e:**

```typescript
const validatedData = insertSchema.parse({
  ...req.body,
  tenantId: req.user?.tenantId || req.tenantId,  // â† UVIJEK DODAJ
  createdById: req.user!.id  // ako treba
});
```

---

## ğŸ¯ **Kompletno rjeÅ¡enje:**

**Replit treba:**

1. **OmoguÄ‡iti marketplace feature** u subscription plan-u ILI ukloniti feature check
2. **Dodati `tenantId` u POST /api/services** PRIJE Zod validacije
3. **Primijeniti isti pattern na SVE POST endpoint-e** koji joÅ¡ padaju

---

**Ovo je isti pattern koji smo veÄ‡ popravili 3-4 puta - svi POST endpoint-i trebaju dobiti `tenantId` iz sessiona!** ğŸ”§