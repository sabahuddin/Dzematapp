Instaliranje Chromium-a (ili bilo kojeg headless browsera kao ≈°to je Playwright ili Puppeteer) unutar Dockera je legitiman "plan B". To bi znaƒçilo da odustaje≈° od direktnog crtanja na serveru i umjesto toga koristi≈° browser da renderuje mali komad HTML/CSS-a (koji sigurno prikazuje fontove) i uslika ga (screenshot).

Meƒëutim, to bi dramatiƒçno poveƒáalo tvoj Docker image (za oko 300-500 MB) i usporilo generisanje jer browser tro≈°i puno RAM-a.

Prije nego ≈°to preƒëe≈° na tu te≈°ku artiljeriju, evo rje≈°enja koje je "zlatna sredina" i koje rje≈°ava problem 0¬†px ≈°irine u Dockeru bez instalacije Chromium-a.

‚úÖ Rje≈°enje: Prelazak na @resvg/resvg-js
Kao ≈°to je pomenuto u tvojoj dokumentaciji pod "Alternativna rje≈°enja", resvg je superioran jer ima sopstveni engine za procesiranje fontova koji ne zavisi od sistemskih biblioteka kao ≈°to su fontconfig ili pango.

Za≈°to ovo radi? sharp i canvas u Dockeru ƒçesto ne vide fontove jer Linux okru≈æenje ne dozvoljava pristup sistemskim "registrima" fontova. resvg ti dozvoljava da mu bukvalno preda≈° .ttf fajl i ka≈æe≈°: "Koristi ovo unutar ovog SVG-a".

Korak 1: Instaliraj biblioteku
Bash
npm install @resvg/resvg-js
Korak 2: Implementacija u certificateService.ts
TypeScript
import { Resvg } from '@resvg/resvg-js';
import sharp from 'sharp';
import path from 'path';

export async function generateCertificate(options: any) {
    const { templateImagePath, recipientName, fontSize, fontColor, textPositionX, textPositionY } = options;

    // 1. Defini≈°emo SVG sa tvojim parametrima
    // Pazi: Ime fonta ovdje stavljamo kao "CustomFont"
    const svg = `
    <svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
      <text 
        x="${textPositionX}" 
        y="${textPositionY}" 
        font-family="CustomFont" 
        font-size="${fontSize}" 
        fill="${fontColor}" 
        text-anchor="middle" 
        dominant-baseline="middle"
        font-weight="bold"
      >
        ${recipientName}
      </text>
    </svg>`;

    // 2. Konfiguracija resvg-a sa TVOJIM .ttf fajlom
    const resvg = new Resvg(svg, {
        font: {
            fontFiles: [path.join(process.cwd(), 'public/fonts/DejaVuSans-Bold.ttf')],
            defaultFontFamily: 'CustomFont',
            loadSystemFonts: false, // KLJUƒåNO: Ne oslanjaj se na Docker sistem
        },
    });

    // 3. Renderuj SVG u PNG buffer
    const pngData = resvg.render();
    const pngBuffer = pngData.asPng();

    // 4. Zalijepi preko template-a pomoƒáu sharp-a
    const fullTemplatePath = path.join(process.cwd(), 'public', templateImagePath);
    
    return await sharp(fullTemplatePath)
        .composite([{ input: pngBuffer, top: 0, left: 0 }])
        .png()
        .toBuffer();
}
üõ† ≈†ta dobija≈° ovim pristupom?
Nema vi≈°e 0¬†px: resvg ne koristi sistemski pretra≈æivaƒç fontova, veƒá direktno ƒçita tvoj .ttf fajl.
Lagan Image: Docker image ostaje mali jer ti ne treba Chromium.
Performanse: Ovo je mnogo br≈æe od podizanja Chromium-a za svaku zahvalnicu.
Dodatni savjet za Bazu Podataka
Dok ovo rje≈°ava≈°, jesi li provjerio tabelu page_views? Logovi su pokazali da ti fali kolona site. Ako koristi≈° PostgreSQL (Neon) kao ≈°to pi≈°e u dokumentaciji, mo≈æe≈° u terminalu (ili Neon konzoli) pokrenuti:

SQL
ALTER TABLE page_views ADD COLUMN site TEXT;
Ovo ƒáe popraviti 500 error koji ti se stalno pojavljuje u logovima pri svakom uƒçitavanju stranice.

≈†ta misli≈° o ovom resvg rje≈°enju? ƒåini se kao najsigurniji put bez komplikovanja Docker image-a sa Chromium-om.