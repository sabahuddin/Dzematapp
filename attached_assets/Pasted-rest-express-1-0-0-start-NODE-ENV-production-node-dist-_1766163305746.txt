rest-express@1.0.0 start
> NODE_ENV=production node dist/index.js
ğŸ”— Created symlink: /app/server/public -> ../public
âœ… Using PostgreSQL session store
ğŸ”„ Starting database schema synchronization...
ğŸ”„ Running production schema migration...
ğŸ§¹ Cleaning up broken data references...
âœ… Cleaned up broken data references
ğŸ“‹ Fixing badge names (lowercase second word)...
âœ… Badge names fixed
ğŸ”§ Fixing certificate_templates columns...
âœ… Fixed certificate_templates columns
â„¹ï¸  Tables already exist, applying column fixes...
ğŸ“‹ Creating missing tables...
âœ… Table creation complete: 26 processed, 0 already existed
ğŸ“‹ Migrating unique constraints to per-tenant...
âœ… Unique constraints migrated to per-tenant
ğŸ“‹ Adding membership payment unique constraint...
âœ… Membership payment constraint added
ğŸ“‹ Updating admin usernames to new standard...
âœ… Admin usernames and names updated
ğŸ“‹ Adding missing columns to existing tables...
âœ… Processed 216 column fixes (0 skipped)
ğŸ“‹ Fixing NOT NULL constraints on created_by_id columns...
âœ… Fixed 4 NOT NULL constraints
ğŸ“‹ Fixing NOT NULL constraints on legacy 'title' columns...
âœ… Fixed events.start_date NOT NULL constraint
âœ… Synced events.date_time â†’ start_date
âœ… Fixed 1 legacy 'title' NOT NULL constraints
ğŸ“‹ Fixing membership_applications nullable fields...
âœ“ country
âœ“ email
âœ“ employment_status
âœ“ occupation
âœ“ skills_hobbies
âœ“ spouse_name
âœ“ spouse_phone
âœ“ children_info
âœ“ reviewed_by_id
âœ“ reviewed_at
âœ“ review_notes
âœ“ photo
âœ… Fixed 12 membership_applications nullable constraints
ğŸ“‹ Assigning registry numbers to existing members...
âœ… Assigned registry numbers to 0 existing members
ğŸ“‹ Migrating user foreign key constraints to CASCADE...
âœ… Migrated 26 foreign key constraints to CASCADE
ğŸ“‹ Migrating title->name for legacy tables...
âœ… Migrated events: copied title->name
âœ… Migrated 1 tables (title->name)
ğŸ“‹ Syncing membership settings currency with organization...
âœ… Membership currency synced with organization settings
ğŸ“‹ Adding default_currency column to tenants...
âœ… default_currency column added
ğŸ“‹ Fixing tenant enabled_modules with correct module IDs...
âœ… Tenant enabled_modules fixed for full-tier tenants
âœ… Schema migration complete
ğŸ“‹ Verifying all schema tables exist...
âœ… All 47 tables verified
âœ… Database schema synchronized successfully!
ğŸ” Checking upload paths, cwd: /app dirname: /app/dist
ğŸ“‚ Serving uploads from: /app/public/uploads
[INIT] Registering /api/auth/superadmin/login endpoint
ğŸ“‚ Serving static files from: /app/dist/public
4:52:31 PM [express] serving on port 3000
âœ… Admin user already exists
ğŸŒ± Starting default tenant seed...
ğŸ“‹ Creating subscription plans...
ğŸ“‹ Updating existing subscription plans with latest modules...
âœ… Full plan modules updated
ğŸ” Creating SuperAdmin global tenant...
â„¹ï¸  SuperAdmin global tenant already exists
ğŸ¢ Creating default tenant...
â„¹ï¸  Default tenant already exists: Demo DÅ¾emat
ğŸ‘¤ Creating SuperAdmin user...
â„¹ï¸  SuperAdmin user already exists
ğŸ‘¤ Creating demo tenant admin...
â„¹ï¸  Demo admin user already exists
âœ… Seed completed successfully!
ğŸ“Š Default Tenant ID: default-tenant-demo
Name: Demo DÅ¾emat
Tier: full
Status: active
ğŸŒ± Seeding demo data for Demo DÅ¾emat...
ğŸ… Seeding badges for 9 tenants...
ğŸ… Seeding badges for tenant: cdede0a0-ae2f-46ff-bc8b-ce564797f974...
â„¹ï¸ Demo users already exist
â„¹ï¸  Badges already exist for tenant cdede0a0-ae2f-46ff-bc8b-ce564797f974 (16 badges)
ğŸ… Seeding badges for tenant: eff2c096-9919-4f84-aa50-6e22b5ea2daf...
â„¹ï¸ Demo data already exists
âœ… Demo data seed completed!
â„¹ï¸  Badges already exist for tenant eff2c096-9919-4f84-aa50-6e22b5ea2daf (16 badges)
ğŸ… Seeding badges for tenant: fd1a86ee-a02b-45fa-b47e-63fe420645b7...
â„¹ï¸  Badges already exist for tenant fd1a86ee-a02b-45fa-b47e-63fe420645b7 (16 badges)
ğŸ… Seeding badges for tenant: default-tenant-demo...
â„¹ï¸  Badges already exist for tenant default-tenant-demo (16 badges)
ğŸ… Seeding badges for tenant: 101da89b-26c5-46fe-96b3-5191c793da8a...
â„¹ï¸  Badges already exist for tenant 101da89b-26c5-46fe-96b3-5191c793da8a (16 badges)
ğŸ… Seeding badges for tenant: 7f01db00-756c-47d0-819b-d1b9e5f5822e...
â„¹ï¸  Badges already exist for tenant 7f01db00-756c-47d0-819b-d1b9e5f5822e (16 badges)
ğŸ… Seeding badges for tenant: 1a3195d8-bc32-4bb9-a1c8-9bca078a7aa0...
â„¹ï¸  Badges already exist for tenant 1a3195d8-bc32-4bb9-a1c8-9bca078a7aa0 (16 badges)
ğŸ… Seeding badges for tenant: 41beaa51-e68e-4f5e-aa58-ba3af7f8538a...
â„¹ï¸  Badges already exist for tenant 41beaa51-e68e-4f5e-aa58-ba3af7f8538a (16 badges)
âœ… Badge seeding complete for all tenants
ğŸ§¹ [AUTO-PURGE] Starting automatic demo user cleanup...
[AUTO-PURGE] Found 9 tenants
[AUTO-PURGE] Processing tenant: SuperAdmin Global
[AUTO-PURGE] Processing tenant: DÅ¾emat GAM
[AUTO-PURGE] Processing tenant: DÅ¾emat Oslo
[AUTO-PURGE] Processing tenant: IK Graz
[AUTO-PURGE] Skipping demo tenant Demo DÅ¾emat
[AUTO-PURGE] Processing tenant: Zajednica BoÅ¡njaka Georgia
[AUTO-PURGE] Processing tenant: Bosnian Islamic Center of Saint Louis
[AUTO-PURGE] Processing tenant: DÅ¾emat Ponikve
[AUTO-PURGE] Processing tenant: Zapadna NorveÅ¡ka
[AUTO-PURGE] âœ… Automatic demo user cleanup completed!
[AUTH MIDDLEWARE] User loaded: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
username: 'admin',
userTenantId: 'default-tenant-demo',
sessionTenantId: 'default-tenant-demo',
sessionIsSuperAdmin: undefined,
userIsSuperAdmin: true,
resolvedIsSuperAdmin: false
}
[AUTH MIDDLEWARE] Final tenantId: default-tenant-demo
[MESSAGES/UNREAD-COUNT] Debug: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
sessionTenantId: 'default-tenant-demo',
userTenantId: 'default-tenant-demo',
reqTenantId: 'default-tenant-demo',
resolvedTenantId: 'default-tenant-demo'
}
4:52:36 PM [express] GET /api/messages/unread-count 304 in 18ms :: {"count":0}
[AUTH MIDDLEWARE] User loaded: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
username: 'admin',
userTenantId: 'default-tenant-demo',
sessionTenantId: 'default-tenant-demo',
sessionIsSuperAdmin: undefined,
userIsSuperAdmin: true,
resolvedIsSuperAdmin: false
}
[AUTH MIDDLEWARE] Final tenantId: default-tenant-demo
4:52:36 PM [express] GET /api/notifications/unread 304 in 37ms :: {"shop":0,"events":0,"announcementâ€¦
[AUTH MIDDLEWARE] User loaded: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
username: 'admin',
userTenantId: 'default-tenant-demo',
sessionTenantId: 'default-tenant-demo',
sessionIsSuperAdmin: undefined,
userIsSuperAdmin: true,
resolvedIsSuperAdmin: false
}
[AUTH MIDDLEWARE] Final tenantId: default-tenant-demo
4:52:51 PM [express] GET /api/certificates/unviewed-count 304 in 14ms :: {"count":0}
[AUTH MIDDLEWARE] User loaded: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
username: 'admin',
userTenantId: 'default-tenant-demo',
sessionTenantId: 'default-tenant-demo',
sessionIsSuperAdmin: undefined,
userIsSuperAdmin: true,
resolvedIsSuperAdmin: false
}
[AUTH MIDDLEWARE] Final tenantId: default-tenant-demo
[MESSAGES/UNREAD-COUNT] Debug: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
sessionTenantId: 'default-tenant-demo',
userTenantId: 'default-tenant-demo',
reqTenantId: 'default-tenant-demo',
resolvedTenantId: 'default-tenant-demo'
}
4:53:06 PM [express] GET /api/messages/unread-count 304 in 15ms :: {"count":0}
[AUTH MIDDLEWARE] User loaded: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
username: 'admin',
userTenantId: 'default-tenant-demo',
sessionTenantId: 'default-tenant-demo',
sessionIsSuperAdmin: undefined,
userIsSuperAdmin: true,
resolvedIsSuperAdmin: false
}
[AUTH MIDDLEWARE] Final tenantId: default-tenant-demo
4:53:06 PM [express] GET /api/notifications/unread 304 in 40ms :: {"shop":0,"events":0,"announcementâ€¦
[AUTH MIDDLEWARE] User loaded: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
username: 'admin',
userTenantId: 'default-tenant-demo',
sessionTenantId: 'default-tenant-demo',
sessionIsSuperAdmin: undefined,
userIsSuperAdmin: true,
resolvedIsSuperAdmin: false
}
[AUTH MIDDLEWARE] Final tenantId: default-tenant-demo
4:53:21 PM [express] GET /api/certificates/unviewed-count 304 in 12ms :: {"count":0}
[AUTH MIDDLEWARE] User loaded: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
username: 'admin',
userTenantId: 'default-tenant-demo',
sessionTenantId: 'default-tenant-demo',
sessionIsSuperAdmin: undefined,
userIsSuperAdmin: true,
resolvedIsSuperAdmin: false
}
[AUTH MIDDLEWARE] Final tenantId: default-tenant-demo
[MESSAGES/UNREAD-COUNT] Debug: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
sessionTenantId: 'default-tenant-demo',
userTenantId: 'default-tenant-demo',
reqTenantId: 'default-tenant-demo',
resolvedTenantId: 'default-tenant-demo'
}
4:53:36 PM [express] GET /api/messages/unread-count 304 in 16ms :: {"count":0}
[AUTH MIDDLEWARE] User loaded: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
username: 'admin',
userTenantId: 'default-tenant-demo',
sessionTenantId: 'default-tenant-demo',
sessionIsSuperAdmin: undefined,
userIsSuperAdmin: true,
resolvedIsSuperAdmin: false
}
[AUTH MIDDLEWARE] Final tenantId: default-tenant-demo
4:53:36 PM [express] GET /api/notifications/unread 304 in 43ms :: {"shop":0,"events":0,"announcementâ€¦
[AUTH MIDDLEWARE] User loaded: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
username: 'admin',
userTenantId: 'default-tenant-demo',
sessionTenantId: 'default-tenant-demo',
sessionIsSuperAdmin: undefined,
userIsSuperAdmin: true,
resolvedIsSuperAdmin: false
}
[AUTH MIDDLEWARE] Final tenantId: default-tenant-demo
4:53:51 PM [express] GET /api/certificates/unviewed-count 304 in 13ms :: {"count":0}
[AUTH MIDDLEWARE] User loaded: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
username: 'admin',
userTenantId: 'default-tenant-demo',
sessionTenantId: 'default-tenant-demo',
sessionIsSuperAdmin: undefined,
userIsSuperAdmin: true,
resolvedIsSuperAdmin: false
}
[AUTH MIDDLEWARE] Final tenantId: default-tenant-demo
[MESSAGES/UNREAD-COUNT] Debug: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
sessionTenantId: 'default-tenant-demo',
userTenantId: 'default-tenant-demo',
reqTenantId: 'default-tenant-demo',
npm warn config production Use `--omit=dev` instead.
resolvedTenantId: 'default-tenant-demo'
}
4:54:06 PM [express] GET /api/messages/unread-count 304 in 15ms :: {"count":0}
[AUTH MIDDLEWARE] User loaded: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
username: 'admin',
userTenantId: 'default-tenant-demo',
sessionTenantId: 'default-tenant-demo',
sessionIsSuperAdmin: undefined,
userIsSuperAdmin: true,
resolvedIsSuperAdmin: false
}
[AUTH MIDDLEWARE] Final tenantId: default-tenant-demo
4:54:07 PM [express] GET /api/notifications/unread 304 in 40ms :: {"shop":0,"events":0,"announcementâ€¦
[AUTH MIDDLEWARE] User loaded: {
userId: '60572500-4eef-4282-a898-a33be6c3f6ba',
username: 'admin',
userTenantId: 'default-tenant-demo',
sessionTenantId: 'default-tenant-demo',
sessionIsSuperAdmin: undefined,
userIsSuperAdmin: true,
resolvedIsSuperAdmin: false
}
[AUTH MIDDLEWARE] Final tenantId: default-tenant-demo
4:54:21 PM [express] GET /api/certificates/unviewed-count 304 in 10ms :: {"count":0}