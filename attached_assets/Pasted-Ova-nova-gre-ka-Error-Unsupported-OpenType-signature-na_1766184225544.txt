Ova nova gre코ka Error: Unsupported OpenType signature nam ta캜no govori u 캜emu je problem: opentype.js ne mo쬰 pro캜itati tvoj font fajl. To se obi캜no de코ava ako je .ttf fajl o코te캖en, pogre코no komprimovan ili ako poku코ava코 u캜itati .webp sliku kao font.

Evo kako da ovo popravi코 i kona캜no dobije코 vidljiv tekst na certifikatu:

1. Rje코enje za font (OpenType error)
opentype.js je veoma osjetljiv na format. Ako tvoj font buffer po캜inje pogre코nim bajtovima, dobi캖e코 ovaj error.
맚a uraditi: Provjeri da li je public/fonts/DejaVuSans-Bold.ttf zaista ispravan font fajl.
Preporuka: Vrati se na resvg metodu koju smo koristili u prethodnom koraku jer je ona uspje코no renderirala 5580막ajtova teksta bez opentype.js gre코aka.
2. Za코to je certifikat bio "prazan" sa resvg?
Ako je resvg generisao buffer, a ti vidi코 praznu sliku, problem je u koordinatama ili boji unutar SVG stringa.

Ispravi SVG string u certificateService.ts ovako:

TypeScript
const svg = `
<svg width="1200" height="800" viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <rect width="100%" height="100%" fill="none" /> <text 
    x="${textPositionX}" 
    y="${textPositionY}" 
    font-family="DejaVu Sans" 
    font-size="${fontSize}" 
    fill="${fontColor || '#000000'}" 
    text-anchor="middle" 
    dominant-baseline="central"
    font-weight="bold"
  >${recipientName}</text>
</svg>`;
Dominant-baseline: Koristi central umjesto middle za bolju vertikalnu poravnatost u resvg.
ViewBox: Obavezno dodaj viewBox="0 0 1200 800" kako bi se koordinate 580,401 precizno mapirale na tvoj template od 1200칑800.
3. Popravi bazu (Analytics Error)
Tvoji logovi su i dalje puni gre코aka: column "site" of relation "page_views" does not exist. Svaki put kad neko otvori stranicu, baza "pukne" na analitici.

Uradi ovo odmah u terminalu:

Bash
# Ako si na serveru, u캠i u psql ili Neon konzolu i pokreni:
ALTER TABLE page_views ADD COLUMN site TEXT;
Ovo 캖e eliminisati 500 error i omogu캖iti aplikaciji da radi glatko.

游댢 Finalna provjera za certifikate
Vrati kod na resvg verziju (obri코i opentype.js jer pravi probleme sa formatom).
Uvjeri se da textPositionX (580) i textPositionY (401) zaista odgovaraju sredini tvog template-a.
Uradi Clean Build u Coolify-u.
Ako i dalje ne vidi코 tekst, poku코aj staviti fontSize na 100 i fontColor na #FF0000 (crvena) samo da potvrdi코 da se bilo 코ta pojavljuje.

콯eli코 li da ti napi코em ta캜an SQL upit koji 캖e코 pokrenuti u Neon konzoli da sredi코 ovu page_views tabelu?