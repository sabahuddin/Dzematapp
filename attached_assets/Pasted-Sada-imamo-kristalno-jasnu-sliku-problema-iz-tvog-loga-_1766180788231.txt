Sada imamo kristalno jasnu sliku problema iz tvog loga.

[Certificate] Font: 40px "DzematCertFont" [Certificate] Text width: 0px

Iako si definisao ime fonta kao "DzematCertFont", tvoj Canvas sistem ga ne prepoznaje ili ga nije uspio povezati sa fiziƒçkim .ttf fajlom na serveru. Kada je ≈°irina 0¬†px, Canvas koristi "fallback" font koji u tvom Docker okru≈æenju (Debian/Alpine) zapravo ne postoji, pa rezultat bude prazan prostor.

Evo konaƒçnog koda za certificateService.ts koji ƒáe ovo rije≈°iti jer koristi apsolutne putanje i direktnu registraciju koju zahtijeva @napi-rs/canvas:

‚úÖ Ispravljeni certificateService.ts
TypeScript
import { createCanvas, GlobalFonts } from '@napi-rs/canvas';
import sharp from 'sharp';
import path from 'path';
import fs from 'fs';

// 1. Registracija fonta sa APSOLUTNOM putanjom
// Koristimo ime "DzematCertFont" jer ga tvoj log veƒá tra≈æi
const fontPath = path.join(process.cwd(), 'public', 'fonts', 'DejaVuSans-Bold.ttf');

if (fs.existsSync(fontPath)) {
    // Registracija MORA biti uspje≈°na prije nego krene≈° crtati
    const success = GlobalFonts.registerFromPath(fontPath, 'DzematCertFont');
    console.log(`[Certificate] Font registration (DzematCertFont): ${success ? 'USPJE≈†NA' : 'NEUSPJE≈†NA'}`);
} else {
    console.error(`[Certificate] KRITIƒåNA GRE≈†KA: Font fajl nije pronaƒëen na: ${fontPath}`);
}

export async function generateCertificate(options: any) {
    const { templateImagePath, recipientName, fontSize, fontColor, textPositionX, textPositionY } = options;

    // 2. Kreiramo overlay iste veliƒçine kao template (prema logu 1200x800)
    const width = 1200;
    const height = 800;
    const canvas = createCanvas(width, height);
    const ctx = canvas.getContext('2d');

    // 3. Postavljanje fonta - PAZI NA NAVODNIKE
    ctx.font = `bold ${fontSize}px "DzematCertFont"`;
    ctx.fillStyle = fontColor || '#4CAF50';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    // 4. VERIFIKACIJA ≈†IRINE - Kljuƒçni korak za logove
    const metrics = ctx.measureText(recipientName);
    console.log(`[Certificate] VERIFIKACIJA: Ime="${recipientName}", Izmjerena ≈°irina=${metrics.width}px`);

    if (metrics.width === 0) {
        console.error(`[Certificate] UPOZORENJE: ≈†irina teksta je 0! Font "DzematCertFont" nije ispravno primijenjen.`);
    }

    // 5. Crtanje
    ctx.fillText(recipientName, textPositionX, textPositionY);

    const textOverlayBuffer = canvas.toBuffer('image/png');

    // 6. Spajanje sa Sharp-om koristeƒái apsolutnu putanju template-a
    const fullTemplatePath = path.join(process.cwd(), 'public', templateImagePath);
    
    return await sharp(fullTemplatePath)
        .composite([{ 
            input: textOverlayBuffer, 
            top: 0, 
            left: 0 
        }])
        .png()
        .toBuffer();
}
üõ† ≈†ta jo≈° mora≈° uraditi?
Provjera lokacije fonta: Uvjeri se da se tvoj font nalazi taƒçno u public/fonts/DejaVuSans-Bold.ttf unutar tvog projekta.
Docker Rebuild: Buduƒái da Coolify ke≈°ira slojeve, uradi "Force Rebuild without cache" kako bi bio siguran da je novi font fajl ubaƒçen u kontejner.
Baza Podataka: Ne zaboravi rije≈°iti onaj 500 error za analytics tako ≈°to ƒáe≈° dodati kolonu site u tabelu page_views (pomoƒáu db:push ili ruƒçnog SQL-a u bazi).
Za≈°to je ≈°irina bila 0¬†px?
U tvom prethodnom poku≈°aju, sistem je tra≈æio font pod imenom "DzematCertFont", ali taj nadimak (alias) nije bio ispravno povezan sa .ttf fajlom u memoriji Canvas-a. Ovaj novi kod koristi GlobalFonts.registerFromPath koji eksplicitno pravi tu vezu.

ƒåim deploy-a≈° ovo, javi mi da li log sada pokazuje Izmjerena ≈°irina=XXXpx (bilo ≈°ta veƒáe od nule).

≈Ωeli≈° li da ti pomognem sa SQL komandom za popravku one gre≈°ke u bazi (page_views tabela)?