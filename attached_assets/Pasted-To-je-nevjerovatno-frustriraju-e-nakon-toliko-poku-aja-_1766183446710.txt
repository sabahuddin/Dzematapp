To je nevjerovatno frustriraju캖e nakon toliko poku코aja, ali logovi nam govore da smo na samom pragu rje코enja. 캛injenica da je `Text overlay rendered, size: 5580 bytes` zna캜i da je `resvg` **nacrtao tekst**, ali on se ne vidi na finalnoj slici.

Evo tri razloga za코to je certifikat "prazan" i kako to rije코iti odmah:

### 1. Boja teksta i prozirnost (Najvjerovatnije)

Ako je `fontColor` u bazi podataka postavljen na ne코to neispravno ili ako `resvg` ne prepoznaje format boje, tekst mo쬰 biti renderiran kao potpuno proziran ili bijel na bijeloj pozadini.

**맚a uraditi:**
U `certificateService.ts`, privremeno **hardkodiraj** boju u crnu da vidi코 da li 캖e se pojaviti:

```typescript
// Zamijeni ${fontColor} sa fiksnom bojom za test
fill="black" 

```

### 2. Redoslijed slojeva (Z-index u Sharp-u)

Mogu캖e je da `sharp` stavlja tvoj tekstualni overlay **ispod** slike template-a, umjesto iznad.

**맚a uraditi:**
Provjeri `composite` funkciju. Ona mora izgledati ta캜no ovako (overlay mora biti `input`):

```typescript
return await sharp(fullTemplatePath)
    .composite([{ 
        input: pngBuffer, // Ovo je tvoj tekst (overlay)
        top: 0, 
        left: 0 
    }])
    .png()
    .toBuffer();

```

### 3. Problem sa koordinatama (ViewBox)

Ako je tvoj template veliki (npr. ), a ti si kreirao SVG od , tvoj tekst (na koordinatama ) se mo쬯a iscrtava van vidljivog podru캜ja ili na pogre코nom mjestu.

**맚a uraditi:**
Dodaj `viewBox` u tvoj SVG string da osigura코 skaliranje:

```typescript
const svg = `
<svg width="1200" height="800" viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <text 
    x="${textPositionX}" 
    y="${textPositionY}" 
    ...

```

---

### 游뚿 KLJU캛NI TEST: Izbaci Sharp na trenutak

Da bismo bili 100% sigurni gdje je problem, uradi ovo:
Umjesto da 코alje코 finalnu sliku sa template-om, neka tvoj API vrati **samo** `pngBuffer` (onaj 코to ga izbaci `resvg`).

* **Ako je taj PNG prazan:** Problem je u `resvg` konfiguraciji ili samom SVG kodu.
* **Ako taj PNG ima ime na prozirnoj pozadini:** Problem je u `sharp` spajanju (composite).

### I dalje stoji gre코ka u bazi!

Nemoj zaboraviti onaj **Analytics error** iz logova (`column "site" does not exist`). Dok god to ne popravi코 sa `ALTER TABLE page_views ADD COLUMN site TEXT;`, server 캖e tro코iti resurse na gre코ke pri svakom kliku, 코to mo쬰 uzrokovati 캜udna pona코anja i u drugim servisima.

**Moj prijedlog:** Po코alji mi isje캜ak koda gdje defini코e코 taj SVG string i `composite` funkciju, pa 캖u ti poslati fiksnu verziju.